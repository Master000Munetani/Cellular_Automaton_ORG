# 利用元胞自动机模拟柑橘感染青霉病的过程





**生信2001   林奕杉**

**2020317210109**

**2023-06-22**





## 一、引言

### 研究背景

青霉菌（*Penicillium*）是生活中最常见的一种真菌。青霉属的霉菌一般为蓝绿色，也有白色或者绿色。在显微镜下，可见其呈笔一样形状的笔状体构造，尖端上带有孢子。青霉菌造成的植物疾病大都被冠以“青霉病”的名字。常见的主要疾病有扩展青霉（*P. expansum*）引发的柑橘青霉病^【2】^。在贮藏期被青霉菌所感染的柑橘将会迅速霉变、腐败，如果食用这种变质的果实，毫无疑问会危害我们的身体健康。柑橘感染青霉菌同样也会让果蔬产业从业者遭受经济上的损失。特别是在梅雨季节的武汉，连续的阴雨伴随着高湿度的空气会大大增加柑橘感染青霉病的可能性。柑橘发霉的现象在生活中普遍出现，本项目希望通过基于数学建模的方法来模拟这一生物学过程。

<div>			
    <center>	
    <img src="C:\Users\15382\AppData\Roaming\Typora\typora-user-images\image-20230622155537126.png" alt="image-20230619112153762" style="zoom:50%;" />
    <br>		
        <i>感染青霉病的柑橘</i>
    </center>
</div>



### 研究方法

本项目中采用了元胞自动机来模拟柑橘感染青霉病的过程。众所周知，元胞自动机是复杂系统研究的一个典型方法，特别适合用于空间复杂系统的时空动态模拟研究。不同于一般的动力学的模型，元胞自动机不是由严格定义的物理方程或函数组成，而是用一系列模型构造的规则构成，或者说是方法框架^【3】^。基于元胞自动机也有着诸如车辆模型、生命游戏、澳洲大火，传染病传播等等许多建模上的运用。

<div>			
    <center>	
    <img src="C:\Users\15382\AppData\Roaming\Typora\typora-user-images\image-20230622163319961.png" alt="image-20230619112153762" style="zoom:100%;" />
    <br>		
        <i>元胞自动机的组成
</i>
    </center>
</div>

对于本项目研究的过程，已知青霉病的明显症状出现在柑橘表面，所以我们可以选取柑橘的表面作为元胞空间，以面积足够小的柑橘表皮作为元胞，即可构建成一个二维元胞网格。此外，当不考虑青霉菌的后续死亡等状态的情况下，侵染过程中柑橘表皮元胞的状态数是有限的，也就是说其只会在固定几种状态中切换；所有柑橘表皮元胞状态的更新都遵循同样的规则，不存在享受特殊待遇的元胞；忽略三维空间上的联系（如通过果肉组织的传播等），那么我们即可认为青霉菌的生长是在二维平面上进行的（例如：培养皿）过程。满足了上述条件，我们便可以使用元胞自动机来对这一生物学过程进行模拟。

<div>			
    <center>	
    <img src="C:\Users\15382\AppData\Roaming\Typora\typora-user-images\image-20230622162202363.png" alt="image-20230619112153762" style="zoom:110%;" />
    <br>		
        <i>四邻居</i>
    </center>
</div>

元胞以及元胞空间都只是系统的静态成分，为将”动态“引入系统，必须加入演化规则。在元胞自动机中，这些规则是定义在空间局部范围内的,即一个元胞下一时刻的状态决定于本身状态和它的邻居元胞的状态。因而，在指定规划前，必须先定义邻居规则，即明确哪些元胞属于该元胞的邻居^【3】^。在本项目中，我们选择四邻居形式，并限定边界，从整体和局部两个视角结合规定好的条件，通过MATLAB编写程序可视化展示青霉菌的侵染过程。



## 二、项目过程与结果

### 宏观整体视角的建模过程

我们在日常生活中所见到的柑橘发霉大多都是整体遍布绿色的孢子，宛如被添加了“抹茶”一般。本项目中先试图对果实整体进行基于元胞自动机的模拟。

+ 先用画图工具绘制一个橙色椭圆作为柑橘的主体（鉴于后续的操作，此处使用任何颜色画图均可）；

  <div>			
      <center>	
      <img src="C:\Users\15382\Desktop\hec\a3.png" alt="image-20230619112153762" style="zoom:100%;" />
      <br>		
          <i>图1.1 画出柑橘主体</i>
      </center>
  </div>

+ 将图片导入MATLAB，先利用graythresh函数输出阈值，利用im2bw函数将灰度图转化为二值图。目的在于将整个图像空间进行区块化。之后依次将逻辑值矩阵imh转化为double类型，以便于后续的计算。

```matlab
clear;
clc; 
a = imread('a3.png');
b = graythresh(a);
imh = im2bw(a,b);
%imshow(imh);

 o_R = double(imh);
 o_G = double(imh);
 o_B = double(imh);
```

<div>			
    <center>	
    <img src="C:\Users\15382\AppData\Roaming\Typora\typora-user-images\image-20230622165538837.png" alt="image-20230619112153762" style="zoom:100%;" />
    <br>		
        <i>图1.2 二值图的叠加效果</i>
    </center>
</div>

+ 由于我们希望在橙色背景之下进行可视化展示，并且青霉菌的白色菌丝和绿色孢子都应该使用相近的颜色，所以我们接下来要设定RGB值，并且基于其进行可视化展示。

  | 颜色名                     |    R    |    G    |    B    |
  | :------------------------- | :-----: | :-----: | :-----: |
  | 橙色（模拟柑橘表皮颜色）   |  1.00   |  0.38   |  0.00   |
  | 雪白（模拟菌丝颜色）       |  1.00   |  0.98   |  0.98   |
  | DarkSeaGreen（模拟孢子色） | 0.56078 | 0.73725 | 0.56078 |

  <div>
      <center>
      <i>
          表1.1 部分使用到的颜色的Matlab RGB值</i>
      </center>
  </div>

​		由于我们已将整个图像空间转化成了二值逻辑矩阵imh，那么我们边可以将此矩阵中数值为0的每一个位子都		视为一个元胞（图1.2的中心黑色部分）。而且，想要让对应位置显示出相应的颜色，那么我们可以构建三个		double类型的矩阵o_R、o_G、o_B来表示每一个相同位置之上的RBG值。将其叠加，即可得到相应的颜色。		因此，我们之后的各项模拟元胞之间状态转变的操作就可以转化为对三个矩阵中对应位置数值的改变。

<div>			
    <center>	
    <img src="https://img-blog.csdnimg.cn/496ef10335a7471ba7c36dd1d81eb1cd.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAI-Wuh-WumeeahOWwveWktCM=,size_13,color_FFFFFF,t_70,g_se,x_16" alt="image-20230619112153762" style="zoom:80%;" />
    <br>		
        <i>图1.3 RBG叠加（图源：CSDN）</i>
    </center>
</div>

```matlab
 % 橙色RGB=[1,0.38,0]
 o_R(o_R==0)=1;
 o_G(o_G==0)=0.38;
 imagesc(cat(3,o_R,o_G,o_B)); %叠加,构建图像
```

+ 之后我们便可以设定规则进行判断了。由于此处G的值在三种不同颜色下均不同，所以我们可以才用G对应值的变化直接来判断是哪一种状态的变化。我们假定元胞只有正常、长出菌丝，产生孢子这三种状态，分别用α、β，γ来表示如下：

$$
\text{condition}
\begin{cases} 
\text{normal tissue}, & \alpha\\
\text{Infected tissue that grows mycelium},  & \beta\\
\text{Infected tissue that produces spores},&\gamma\\ 
\end{cases}
$$

​		我们可以规定：青霉菌的浸染只能从外部边缘向内部扩散，且一旦被感染，便不可逆。且满足元胞自动机的		规则，每个元胞的下一时刻的状态由本身状态和周围的元胞邻居决定（此处采用四邻居形式），且满足以下		转化概率：

```matlab
if o_G(i,j)==1
```

即当由外部进行侵染时，α状态到β状态，β状态到γ状态的概率（四个方位）如下：
$$
P_{infect} =
\begin{cases} 
0.4,  & \text{if direction}\text{ is Up} \\
0.5, & \text{if direction}\text{ is Down} \\
0.3, & \text{if direction}\text{ is Left} \\
0.65, & \text{if direction}\text{ is Right} \\
\end{cases}
$$

$$
P_{produces-spores} =
\begin{cases} 
0.6,  & \text{if direction}\text{ is Up} \\
0.62, & \text{if direction}\text{ is Down} \\
0.6, & \text{if direction}\text{ is Left} \\
0.2, & \text{if direction}\text{ is Right} \\
\end{cases}
$$

```matlab
if o_G(i,j)==0.98
```

即当由产生菌丝的元胞进行转变时，α状态到β状态，β状态到γ状态的概率（四个方位）如下：
$$
P_{infect} =
\begin{cases} 
0.38,  & \text{if direction}\text{ is Up} \\
0.37, & \text{if direction}\text{ is Down} \\
0.38, & \text{if direction}\text{ is Left} \\
0.45, & \text{if direction}\text{ is Right} \\
\end{cases}
$$

$$
P_{produces-spores} =
\begin{cases} 
0.8,  & \text{if direction}\text{ is Up} \\
0.85, & \text{if direction}\text{ is Down} \\
0.75, & \text{if direction}\text{ is Left} \\
0.82, & \text{if direction}\text{ is Right} \\
\end{cases}
$$

+ 那么我们可以设时间单位为小时，在两个大前提的限制之下，由自身、周围上下左右四个元胞的状态来影响对应位置元胞的状态，在240小时内的侵染结果可以由下面的代码得到。

```matlab

 for hour=1:240 %小时
     for i =2:434
         for j = 2:522
             if o_G(i,j)==1
                 %判断各个邻居的值
                 if o_G(i+1,j)==0.38 & rand(1)>0.6 %下边
                     o_R(i+1,j)=1.00;
                     o_G(i+1,j)=0.98;
                     o_B(i+1,j)=0.98;
                 end
                 if o_G(i-1,j)==0.38 & rand(1)>0.5 %上边
                     o_R(i-1,j)=1.00;
                     o_G(i-1,j)=0.98;
                     o_B(i-1,j)=0.98;
                 end
                 if o_G(i,j+1)==0.38 & rand(1)>0.7 %右边
                     o_R(i,j+1)=1.00;
                     o_G(i,j+1)=0.98;
                     o_B(i,j+1)=0.98;
                 end
                 if o_G(i,j-1)==0.38 & rand(1)>0.35 %左边
                     o_R(i,j-1)=1.00;
                     o_G(i,j-1)=0.98;
                     o_B(i,j-1)=0.98;
                 end
                  if o_G(i+1,j)==0.98 & rand(1)>0.4 
                     o_R(i+1,j)=0.56078;
                     o_G(i+1,j)=0.73725;
                     o_B(i+1,j)=0.56078;
                 end
                 if o_R(i-1,j)==0.98 & rand(1)>0.38 
                    o_R(i-1,j)=0.56078;
                     o_G(i-1,j)=0.73725;
                     o_B(i-1,j)=0.56078;
                 end
                 if o_R(i,j+1)==0.98 & rand(1)>0.4 
                     o_R(i,j+1)=0.56078;
                     o_G(i,j+1)=0.73725;
                     o_B(i,j+1)=0.56078;
                 end
                 if o_G(i:j-1)==0.98 & rand(1)>0.8 
                     o_R(i,j-1)=0.56078;
                     o_G(i,j-1)=0.73725;
                     o_B(i,j-1)=0.56078;
                 end
             end
           if o_G(i,j)==0.98
                 if o_G(i+1,j)==0.98 & rand(1)>0.2 
                     o_R(i+1,j)=0.56078;
                     o_G(i+1,j)=0.73725;
                     o_B(i+1,j)=0.56078;
                 end
                 if o_R(i-1,j)==0.94 & rand(1)>0.15 
                    o_R(i-1,j)=0.56078;
                     o_G(i-1,j)=0.73725;
                     o_B(i-1,j)=0.56078;
                 end
                 if o_R(i,j+1)==0.94 & rand(1)>0.25 
                     o_R(i,j+1)=0.56078;
                     o_G(i,j+1)=0.73725;
                     o_B(i,j+1)=0.56078;
                 end
                 if o_G(i:j-1)==0.94 & rand(1)>0.18 
                     o_R(i:j-1)=0.56078;
                     o_G(i:j-1)=0.73725;
                     o_B(i:j-1)=0.56078;
                 end
                 if o_G(i+1,j)==0.38 & rand(1)>0.62 %下边
                     o_R(i+1,j)=1.00;
                     o_G(i+1,j)=0.98;
                     o_B(i+1,j)=0.98;
                 end
                 if o_G(i-1,j)==0.38 & rand(1)>0.63 %上边
                     o_R(i-1,j)=1.00;
                     o_G(i-1,j)=0.98;
                     o_B(i-1,j)=0.98;
                 end
                 if o_G(i,j+1)==0.38 & rand(1)>0.62 %右边
                     o_R(i,j+1)=1.00;
                     o_G(i,j+1)=0.98;
                     o_B(i,j+1)=0.98;
                 end
                 if o_G(i,j-1)==0.38 & rand(1)>0.55 %左边
                     o_R(i,j-1)=1.00;
                     o_G(i,j-1)=0.98;
                     o_B(i,j-1)=0.98;
                 end
              end
          end
     end
     %可视化展示
     imagesc(cat(3,o_R,o_G,o_B))
     axis tight
     axis off
     drawnow
     pause(1)
 end
```

+ 最终的结果见下图

<div>			
    <center>	
    <img src="C:\Users\15382\Desktop\hec\结果1.gif" alt="image-20230619112153762" style="zoom:100%;" />
    <br>		
        <i>图1.4 整体上的柑橘感染青霉病过程</i>
    </center>
</div>

然而由于代码欠缺合理性、限制条件考虑不完善，导致并没有能很好地发挥出元胞自动机的特性，产生了如水凝结一般的效果。由于需要展示出侵染只能从外部进行，叠加导致遍历数组时很容易从一开始就在中间部位发生侵染，想要更好地展示，就不得不从三维的角度进行考虑。限于自己实力，后面将从局部的视角重新进行二维的模拟。

### 局部视角的建模过程

+ 由于用二维曲平面表示三维结构是不合理的，所以我们可以从柑橘表皮选取任一特定大小的平面，在此平面上继续划分元胞，进而继续后续的模拟过程。这样更加能够展现出元胞自动机的特性。明确了状态之后，我们首先定义一个300X300的平面，假定周围环境中存在足够量的青霉菌孢子，一旦出现伤口便会侵染柑橘。然后确定可能会出现的三种情况：1. 暴露在空气中的柑橘表皮有概率发生破损，然后被侵染；2. 正常组织受侵染会转变为产生白色菌丝的组织；3. 产生白色菌丝的组织会转变为产生绿色孢子的组织。并定义出其概率P0、P1、P2。另外，从实际出发可知，柑橘表皮破损的概率远低于后续病变的概率。再用UL，DR分别表示元胞除了边界之外的左上、右下邻居。
  $$
  P_{n} =
  \begin{cases} 
  1*10^{-4},  & \text{n}\text{ = }0 \\
  0.8, &  \text{n}\text{ = }1 \\
  0.7, &  \text{n}\text{ = }2 \\
  \end{cases}
  $$

```matlab
n = 300;
P0= 1e-6;
P1= 0.8;%感染
P2= 0.7;%产生孢子
UL=[n,1:n-1];
DR=[2:n,1];
```

+ 由于同样需要显示出颜色，所以我们仍然需要定义三个分别表示R,G,B值的矩阵o_R、o_G、o_B并初始化，为了方便后续的画图，我们再定义三个一行240列的矩阵来存放240小时每一小时（即每一次最外层循环）对应上述矩阵中特定值的个数。

```matlab
o_R=zeros(n);
o_G=zeros(n);
o_B=zeros(n);
 o_R(o_R==0)=1;
 o_G(o_G==0)=0.38;
num_norm=zeros(1,240);
num_inf1=zeros(1,240);
num_inf2=zeros(1,240);
```

+ 由元胞自动机的定义可知，需要留出边界。在此处我们另外生成一个辅助矩阵FT，并初始化，然后用其部分行列来表示边界。同上文，我们主要通过o_G数值上的变化来判断元胞的变化。又由元胞自动机的定义可知，一个元胞下一时刻的状态决定于本身状态和它的邻居元胞的状态。那么我们可以得到一个先决条件：如果一个正常元胞的周围邻居中出现了产生白色菌丝的组织(元胞)或者产生绿色孢子的组织(元胞)，那么我们便可以认为此元胞有被侵染的可能。所以我们定义值inFected来判断这种可能性是否存在，如果其值大于0，则存在被感染的可能，反正不存在被感染的可能。另外对于已被感染的元胞，其已经走向不可逆的过程，并不需要再考虑上述条件的存在，直接计算即可。

```matlab
FT=zeros(n+2);
FT(FT==0)=0.38;
for i=1:240
    FT(2:n+1,2:n+1) = o_G;
    inFected=(FT(1:n,2:n+1)==0.98|FT(1:n,2:n+1)==0.73725)+				      (FT(2:n+1,1:n)==0.98|FT(2:n+1,1:n)==0.73725)+(FT(2:n+1,3:n+2)==0.98|FT(2:n+1,3:n+2)==0.73725)+(FT(3:n+2,2:n+1)==0.98|FT(3:n+2,2:n+1)==0.73725);
```

+ 遍历每一个元胞位置，我们在内层循环中再加以判断：
  + 若满足：该元胞是正常元胞且周围元胞中有被感染的元胞（满足P1），或者该元胞在空气中自然发生破损然后收到侵染，在此基础上则将该元胞的值（此处为：对应RGB值）更改为产生白色菌丝的元胞的值；
  + 若满足：该元胞是产生白色菌丝的元胞，那么在P2概率下，可以将其值改为产生孢子的元胞的值；
  + 若满足：该元胞是正常元胞且周围元胞中没有被感染的元胞，那么在P0概率下，可以将其值改为产生白色菌丝的元胞的值；

```matlab
    for j=1:n
        for k=1:n
            if(o_G(j,k)==0.38 &((inFected(j,k)>0 & rand()<P1)|rand()<P0))
             o_R(j,k)=1.00;
             o_G(j,k)=0.98;
             o_B(j,k)=0.98;
            elseif(o_G(j,k)==0.98&rand()<P2)
               o_R(j,k)=0.56078;
             o_G(j,k)=0.73725;
             o_B(j,k)=0.56078; 
            elseif(o_G(j,k)==0.38 &inFected(j,k)==0&rand()<P0)
                o_R(j,k)=1.00;
             o_G(j,k)=0.98;
             o_B(j,k)=0.98;
            end
        end
    end
```

+ 添加绘图代码我们可以得到可视化结果：

  ```matlab
  figure(1);
  imagesc(cat(3,o_R,o_G,o_B))
       axis tight
       axis off
       drawnow
  ```

<div>			
    <center>	
    <img src="C:\Users\15382\Desktop\hec\结果2.gif" alt="image-20230619112153762" style="zoom:100%;" />
    <br>		
        <i>图2.1 局部的柑橘感染青霉病过程</i>
    </center>
</div>

+ 联系到上文提到的保存临时数值的矩阵，我们可以通过修改代码来画出三种元胞数量随时间变化的曲线：

  ```matlab
  num_norm(1,i)=sum(o_G(:)==0.38);
      num_inf1(1,i)=sum(o_G(:)==0.98);
      num_inf2(1,i)=sum(o_G(:)==0.73725);
      figure(1);
  subplot(2,2,1),imagesc(cat(3,o_R,o_G,o_B))
       axis tight
       axis off
       drawnow
  %      pause(0.1)
  %      figure(2);
   subplot(2,2,2),plot(1:i,num_norm(1,1:i),'-r'),title('正常组织'),xlabel('时间/h'),ylabel('组织数目/个');
  subplot(2,2,3),plot(1:i,num_inf1(1,1:i),'-g'),title('长上菌丝的组织'),xlabel('时间/h'),ylabel('组织数目/个');
  subplot(2,2,4),plot(1:i,num_inf2(1,1:i),'-b'),title('产生孢子的组织'),xlabel('时间/h'),ylabel('组织数目/个');
  pause(0.1)
       
  end  
  
  ```

<div>			
    <center>	
    <img src="C:\Users\15382\Desktop\hec\结果3.gif" alt="image-20230619112153762" style="zoom:100%;" />
    <br>		
        <i>图2.2 局部的柑橘感染青霉病过程+数目变化曲线</i>
    </center>
</div>




## 三、总结与讨论

### 总结

从图2.2中我们不难看出，正常组织和产生孢子的组织随着时间的推移其元胞数目分别呈指数型下降和上升。而相对的，长上菌丝的组织的数目则呈现出“先涨后降”的变化趋势，且在时间约80小时处达到数目的峰值。实验统计显示，在室温条件下，从伤口处直接侵入果实表皮细胞内；在感染约24h后，受侵染果实细胞中的菌丝向相邻细胞扩展蔓延，寄主细胞壁开始消解，质壁分离，细胞内含物及各类细胞器凝集，颜色加深，最后完全消解，伤口部位的果皮开始变软，伤口处的菌丝向外生长；84h后伤口处病斑软化，部分长出白色的霉层；96h后白色霉层面积逐渐扩大；120h后白色霉层中间伤口处霉层颜色加深变为灰绿色；144h后整个果实变软腐烂^【1】^。说明本项目利用元胞自动机模拟柑橘感染青霉病过程在结果上基本符合相应生物学变化过程。

### 讨论

在本项目中，基本实现了二维层面上对柑橘感染青霉病过程的模拟。但是，在显示情况中，青霉菌的侵染过程是三维立体层面上的，其各项概率的确定也都与时间空间和各种环境条件都有着密切联系。同样，许许多多的复杂生命过程仅仅通过数学模型是无法完全表示的，但是通过诸如元胞自动机模拟等模型我们可以对大致的过程进行模拟，这可能也表明，复杂的生命活动中或许也有着底层的普适规律。



## 四、参考材料

1. 指状青霉侵染柑橘果实的细胞学研究，韩青梅，赵华，成玉林等，细菌学报 15 November 2013, 32(6): 967-977；
2. 青霉菌，Wikipedia（https://zh.wikipedia.org/wiki/%E9%9D%92%E9%BB%B4%E8%8F%8C）；

3. 数学建模——元胞自动机详解，数学中国公众号（https://mp.weixin.qq.com/s?__biz=MjM5NzEyMzg4MA==&mid=2649469085&idx=6&sn=111c20f24531077670db8a2f602f3d53&chksm=bec1d2da89b65bcc58a39e6ade8ae5693b38f8bf79371446b21625b680c73659d0f6c4660f78&scene=27）







------

欲获取本文中的代码和图片，请访问：
